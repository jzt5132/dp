library(data.table)
library(dp)

###############################################################################
#                                                                             #
#                 D I R                                                       #
#                                                                             #
###############################################################################
datadir <- "//40278DFWYM13/Na/test/"
source("//40278DFWYM13/Na/r_fn.R")

args <- commandArgs(trailingOnly = TRUE)
nd <- args[1]

dt <- readRDS(paste0(datadir, "dt_", nd, ".rds" ))
###############################################################################
#                                                                             #
#           C O R E    O P T                                                  #
#                                                                             #
###############################################################################
x <- list()
dt[, list(dp(ac, att, ach, avg_f, sell, idx)), by = idx]


###############################################################################
#                                                                             #
#         S A V E                                                             #
#                                                                             #
###############################################################################
saveRDS(x, paste0(datadir, "res_", nd, ".rds"))
t1 <- proc.time()
message("Total run time is ", round((t1 - t0)[3], 2), "secs!")
